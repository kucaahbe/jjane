<%= title 'Sorting pages' %>

<% content_for :head do -%>
  <script type="text/javascript">
    //<![CDATA[
  function get_class_by_regexp(e,reg_exp) {
    var classList = e.attr('class').split(' ');
    var result = null;
    var re = new RegExp(reg_exp);
    $.each(classList, function(index, klass) {
	    if ( re.exec(klass)!=null ) { result = klass; }
	    });
    return result;
  };
function level(e) {return parseInt(get_class_by_regexp(e,/level_\d+/).replace(/level_/,''));};
function lft(e) {return parseInt(get_class_by_regexp(e,/lft_\d+/).replace(/lft_/,''));};
function rgt(e) {return parseInt(get_class_by_regexp(e,/rgt_\d+/).replace(/rgt_/,''));};
  $(function() {
      $('#sortable_pages').sortable({ 
cursor: 'move',
handle:'.mover',
grid: [20, 31],
placeholder: 'ui-state-highlight',
// callbacks:
start: function(event,ui) {
ui.helper.css('border','1px solid transparent');
}
});
      $("#sortable_pages").disableSelection();
      });
//]]>
</script>
<style type="text/css">
  #sortable_pages {list-style-type:none;margin:0;padding:0;width:60%;}
  #sortable_pages li {
    margin:3px;
    padding:3px;
    font-size:15px;
    border:1px solid blue;
  }
  #sortable_pages li span {
    display:inline-block;
    vertical-align:middle;
  }
  .ui-state-highlight {height:20px;}
</style>
<% end -%>

<ul class="jjane" id="sortable_pages">
  <%- @pages.each do |p| -%>
    <% content_tag :li, :id => "page_#{p[:page].id}", :class => %[level_#{p[:level]} lft_#{p[:page].lft} rgt_#{p[:page].rgt}], :style => %[padding-left:#{27+20*p[:level]}px;] do %>
      <%= content_tag :span, '', :class => 'mover ui-icon ui-icon-arrow-4' %>
      <%= p[:page].menu %>
    <% end %>
  <%- end -%>
</ul>
